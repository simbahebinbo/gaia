"use strict";(self.webpackChunkcosmos_hub_docs_site=self.webpackChunkcosmos_hub_docs_site||[]).push([[1714],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>u});var n=t(7294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=n.createContext({}),p=function(e){var a=n.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},c=function(e){var a=p(e.components);return n.createElement(l.Provider,{value:a},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},h=n.forwardRef((function(e,a){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(t),h=o,u=m["".concat(l,".").concat(h)]||m[h]||d[h]||r;return t?n.createElement(u,i(i({ref:a},c),{},{components:t})):n.createElement(u,i({ref:a},c))}));function u(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=h;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s[m]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<r;p++)i[p]=t[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},570:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var n=t(7462),o=(t(7294),t(3905));const r={title:"Cosmos Hub 3 Upgrade",order:1},i=void 0,s={unversionedId:"migration/cosmoshub-3/cosmoshub-3",id:"migration/cosmoshub-3/cosmoshub-3",title:"Cosmos Hub 3 Upgrade",description:"The following document describes the necessary steps involved that validators and full node operators",source:"@site/docs/migration/cosmoshub-3/cosmoshub-3.md",sourceDirName:"migration/cosmoshub-3",slug:"/migration/cosmoshub-3/",permalink:"/migration/cosmoshub-3/",draft:!1,tags:[],version:"current",frontMatter:{title:"Cosmos Hub 3 Upgrade",order:1},sidebar:"tutorialSidebar",previous:{title:"Cosmos Hub 2 Upgrade",permalink:"/migration/cosmoshub-2/"},next:{title:"Cosmos Hub 4, Gaia v10 Upgrade Instructions",permalink:"/migration/cosmoshub-4-v10-upgrade"}},l={},p=[{value:"Preliminary",id:"preliminary",level:2},{value:"Major Updates",id:"major-updates",level:2},{value:"Risks",id:"risks",level:2},{value:"Recovery",id:"recovery",level:2},{value:"Upgrade Procedure",id:"upgrade-procedure",level:2},{value:"Notes for Service Providers",id:"notes-for-service-providers",level:2}],c={toc:p},m="wrapper";function d(e){let{components:a,...t}=e;return(0,o.kt)(m,(0,n.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"The following document describes the necessary steps involved that validators and full node operators\nmust take in order to upgrade from ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-3")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-4"),". The Cosmos teams\nwill post an official ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-4")," genesis file, but it is recommended that validators\nexecute the following instructions in order to verify the resulting genesis file."),(0,o.kt)("p",null,"There is a strong social consensus around proposal ",(0,o.kt)("inlineCode",{parentName:"p"},"Cosmos Hub 4 Upgrade Proposal"),"\non ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-3"),". Following proposals #",(0,o.kt)("a",{parentName:"p",href:"https://www.mintscan.io/cosmos/proposals/27"},"27"),", #",(0,o.kt)("a",{parentName:"p",href:"https://www.mintscan.io/cosmos/proposals/35"},"35")," and #",(0,o.kt)("a",{parentName:"p",href:"https://www.mintscan.io/cosmos/proposals/36"},"36"),".\nThis indicates that the upgrade procedure should be performed on ",(0,o.kt)("inlineCode",{parentName:"p"},"February 18, 2021 at 06:00 UTC"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#summary"},"Summary")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#migrations"},"Migrations")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#preliminary"},"Preliminary")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#major-updates"},"Major Updates")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#risks"},"Risks")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#recovery"},"Recovery")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#upgrade-procedure"},"Upgrade Procedure")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#guidance-for-full-node-operators"},"Guidance for Full Node Operators")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#notes-for-service-providers"},"Notes for Service Providers"))),(0,o.kt)("h1",{id:"summary"},"Summary"),(0,o.kt)("p",null,"The Cosmoshub-3 will undergo a scheduled upgrade to Cosmoshub-4 on Feb 18, 2021 at 6 UTC."),(0,o.kt)("p",null,"The following is a short summary of the upgrade steps:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"1. Stopping the running Gaia v2.0.x instance\n1. Backing up configs, data, and keys used for running Cosmoshub-3\n1. Resetting state to clear the local Cosmoshub-3 state\n1. Copying the cosmoshub-4 genesis file to the Gaia config folder (either after migrating an existing cosmoshub-3 genesis export, or downloading the cosmoshub-4 genesis from the mainnet github)\n1. Installing the Gaia v4.0.x release\n1. Starting the Gaia v4.0.x instance to resume the Cosmos hub chain at a height of <cosmoshub3 height> + 1.\n")),(0,o.kt)("p",null,"Specific instructions for validators are available in ",(0,o.kt)("a",{parentName:"p",href:"#upgrade-procedure"},"Upgrade Procedure"),",\nand specific instructions for full node operators are available in ",(0,o.kt)("a",{parentName:"p",href:"#guidance-for-full-node-operators"},"Guidance for Full Node Operators"),"."),(0,o.kt)("p",null,"Upgrade coordination and support for validators will be available on the #validators-verified channel of the ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/cosmosnetwork"},"Cosmos Discord"),"."),(0,o.kt)("p",null,"The network upgrade can take the following potential pathways:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Happy path: Validator successfully migrates the cosmoshub-3 genesis file to a cosmoshub-4 genesis file, and the validator can successfully start Gaia v4 with the cosmoshub-4 genesis within 1-2 hours of the scheduled upgrade."),(0,o.kt)("li",{parentName:"ol"},"Not-so-happy path: Validators have trouble migrating the cosmoshub-3 genesis to a cosmoshub-4 genesis, but can obtain the genesis file from the Cosmos mainnet github repo and can successfully start Gaia v4 within 1-2 hours of the scheduled upgrade.  "),(0,o.kt)("li",{parentName:"ol"},"Abort path: In the rare event that the team becomes aware of critical issues, which result in an unsuccessful migration within a few hours, the upgrade will be announced as aborted\non the #validators-verified channel of ",(0,o.kt)("a",{parentName:"li",href:"https://discord.gg/cosmosnetwork"},"Discord"),", and validators will need to resume running cosmoshub-3 network without any updates or changes.\nA new governance proposal for the upgrade will need to be issued and voted on by the community.")),(0,o.kt)("h1",{id:"migrations"},"Migrations"),(0,o.kt)("p",null,"These chapters contain all the migration guides to update your app and modules to Cosmos v0.40 Stargate."),(0,o.kt)("p",null,"If you\u2019re running a block explorer, wallet, exchange, validator, or any other service (eg. custody provider) that depends upon the Cosmos Hub or Cosmos ecosystem, you\u2019ll want to pay attention, because this upgrade will involve substantial changes."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/blob/master/docs/migrations/app_and_modules.md"},"App and Modules Migration")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/blob/master/docs/migrations/rest.md"},"REST Endpoints Migration")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://figment.io/resources/cosmos-stargate-upgrade-overview/#ibc"},"Inter-Blockchain Communication (IBC)\u2013 cross-chain transactions")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://figment.io/resources/cosmos-stargate-upgrade-overview/#proto"},"Protobuf Migration \u2013 blockchain performance & dev acceleration")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://figment.io/resources/cosmos-stargate-upgrade-overview/#sync"},"State Sync \u2013 minutes to sync new nodes")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://figment.io/resources/cosmos-stargate-upgrade-overview/#light"},"Full-Featured Light Clients")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://figment.io/resources/cosmos-stargate-upgrade-overview/#upgrade"},"Chain Upgrade Module \u2013 upgrade automation"))),(0,o.kt)("p",null,"If you want to test the procedure before the update happens on 18th of February, please see this post accordingly:"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/gaia/issues/569#issuecomment-767910963"},"https://github.com/cosmos/gaia/issues/569#issuecomment-767910963")),(0,o.kt)("h2",{id:"preliminary"},"Preliminary"),(0,o.kt)("p",null,"Many changes have occurred to the Cosmos SDK and the Gaia application since the latest\nmajor upgrade (",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-3"),"). These changes notably consist of many new features,\nprotocol changes, and application structural changes that favor developer ergonomics\nand application development."),(0,o.kt)("p",null,"First and foremost, ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/ibc/overview.html"},"IBC")," following\nthe ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ics#ibc-quick-references"},"Interchain Standads")," will be enabled.\nThis upgrade comes with several improvements in efficiency, node synchronization and following blockchain upgrades.\nMore details on the ",(0,o.kt)("a",{parentName:"p",href:"https://stargate.cosmos.network/"},"Stargate Website"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://github.com/cosmos/gaia"},"Gaia")," application v4.0.2 is\nwhat full node operators will upgrade to and run in this next major upgrade"),".\nFollowing Cosmos SDK version v0.41.2 and Tendermint v0.34.7."),(0,o.kt)("p",null,"Validators should expect that at least 16GB of RAM needs to be provisioned to process the first new block on cosmoshub-4."),(0,o.kt)("h2",{id:"major-updates"},"Major Updates"),(0,o.kt)("p",null,"There are many notable features and changes in the upcoming release of the SDK. Many of these\nare discussed at a high level\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/stargate"},"here"),"."),(0,o.kt)("p",null,"Some of the biggest changes to take note on when upgrading as a developer or client are the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Protocol Buffers"),": Initially the Cosmos SDK used Amino codecs for nearly all encoding and decoding.\nIn this version a major upgrade to Protocol Buffers have been integrated. It is expected that with Protocol Buffers\napplications gain in speed, readability, convenience and interoperability with many programming languages.\n",(0,o.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/blob/master/docs/migrations/app_and_modules.md#protocol-buffers"},"Read more")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"CLI"),": The CLI and the daemon for a blockchain were separated in previous versions of the Cosmos SDK. This\nled to a ",(0,o.kt)("inlineCode",{parentName:"li"},"gaiad")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"gaiacli")," binary which were separated and could be used for different interactions with the\nblockchain. Both of these have been merged into one ",(0,o.kt)("inlineCode",{parentName:"li"},"gaiad")," which now supports the commands the ",(0,o.kt)("inlineCode",{parentName:"li"},"gaiacli")," previously\nsupported."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Node Configuration"),": Previously blockchain data and node configuration was stored in ",(0,o.kt)("inlineCode",{parentName:"li"},"~/.gaia/"),", these will\nnow reside in ",(0,o.kt)("inlineCode",{parentName:"li"},"~/.gaia/"),", if you use scripts that make use of the configuration or blockchain data, make sure to update the path.")),(0,o.kt)("h2",{id:"risks"},"Risks"),(0,o.kt)("p",null,"As a validator performing the upgrade procedure on your consensus nodes carries a heightened risk of\ndouble-signing and being slashed. The most important piece of this procedure is verifying your\nsoftware version and genesis file hash before starting your validator and signing."),(0,o.kt)("p",null,"The riskiest thing a validator can do is discover that they made a mistake and repeat the upgrade\nprocedure again during the network startup. If you discover a mistake in the process, the best thing\nto do is wait for the network to start before correcting it. If the network is halted and you have\nstarted with a different genesis file than the expected one, seek advice from a Tendermint developer\nbefore resetting your validator."),(0,o.kt)("h2",{id:"recovery"},"Recovery"),(0,o.kt)("p",null,"Prior to exporting ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-3")," state, validators are encouraged to take a full data snapshot at the\nexport height before proceeding. Snapshotting depends heavily on infrastructure, but generally this\ncan be done by backing up the ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia")," directory."),(0,o.kt)("p",null,"It is critically important to back-up the ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia/data/priv_validator_state.json")," file after stopping your gaiad process. This file is updated every block as your validator participates in a consensus rounds. It is a critical file needed to prevent double-signing, in case the upgrade fails and the previous chain needs to be restarted."),(0,o.kt)("p",null,"In the event that the upgrade does not succeed, validators and operators must downgrade back to\ngaia v2.0.15 with v0.37.15 of the ",(0,o.kt)("em",{parentName:"p"},"Cosmos SDK")," and restore to their latest snapshot before restarting their nodes."),(0,o.kt)("h2",{id:"upgrade-procedure"},"Upgrade Procedure"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note"),": It is assumed you are currently operating a full-node running gaia v2.0.15 with v0.37.15 of the ",(0,o.kt)("em",{parentName:"p"},"Cosmos SDK"),"."),(0,o.kt)("p",null,"The version/commit hash of Gaia v2.0.15: ",(0,o.kt)("inlineCode",{parentName:"p"},"89cf7e6fc166eaabf47ad2755c443d455feda02e")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Verify you are currently running the correct version (v2.0.15) of ",(0,o.kt)("em",{parentName:"p"},"gaiad"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"}," $ gaiad version --long\n name: gaia\n server_name: gaiad\n client_name: gaiacli\n version: 2.0.15\n commit: 89cf7e6fc166eaabf47ad2755c443d455feda02e\n build_tags: netgo,ledger\n go: go version go1.15 darwin/amd64\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Make sure your chain halts at the right time and date:\nFebruary 18, 2021 at 06:00 UTC is in UNIX seconds: ",(0,o.kt)("inlineCode",{parentName:"p"},"1613628000")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"perl -i -pe 's/^halt-time =.*/halt-time = 1613628000/' ~/.gaia/config/app.toml\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"After the chain has halted, make a backup of your ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia")," directory"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mv ~/.gaia ./gaiad_backup\n")),(0,o.kt)("p",{parentName:"li"}," ",(0,o.kt)("strong",{parentName:"p"},"NOTE"),": It is recommended for validators and operators to take a full data snapshot at the export\nheight before proceeding in case the upgrade does not go as planned or if not enough voting power\ncomes online in a sufficient and agreed upon amount of time. In such a case, the chain will fallback\nto continue operating ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-3"),". See ",(0,o.kt)("a",{parentName:"p",href:"#recovery"},"Recovery")," for details on how to proceed.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Export existing state from ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-3"),":"),(0,o.kt)("p",{parentName:"li"},"Before exporting state via the following command, the ",(0,o.kt)("inlineCode",{parentName:"p"},"gaiad")," binary must be stopped!\nAs a validator, you can see the last block height created in the\n",(0,o.kt)("inlineCode",{parentName:"p"},"~/.gaia/data/priv_validator_state.json")," - or now residing in ",(0,o.kt)("inlineCode",{parentName:"p"},"gaiad_backup")," when you made\na backup as in the last step - and obtain it with"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cat ~/.gaia/data/priv_validator_state.json | jq '.height'\n")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gaiad export --height=<height> > cosmoshub_3_genesis_export.json\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"this might take a while, you can expect an hour for this step"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Verify the SHA256 of the (sorted) exported genesis file:"),(0,o.kt)("p",{parentName:"li"}," Compare this value with other validators / full node operators of the network.\nGoing forward it will be important that all parties can create the same genesis file export."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ jq -S -c -M '' cosmoshub_3_genesis_export.json | shasum -a 256\n[SHA256_VALUE]  cosmoshub_3_genesis_export.json\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"At this point you now have a valid exported genesis state! All further steps now require\nv4.0.2 of ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/gaia"},"Gaia"),".\nCross check your genesis hash with other peers (other validators) in the chat rooms."),(0,o.kt)("p",{parentName:"li"},"   ",(0,o.kt)("strong",{parentName:"p"},"NOTE"),": Go ",(0,o.kt)("a",{parentName:"p",href:"https://golang.org/dl/"},"1.15+")," is required!"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/cosmos/gaia.git && cd gaia && git checkout v4.0.2; make install\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Verify you are currently running the correct version (v4.0.2) of the ",(0,o.kt)("em",{parentName:"p"},"Gaia"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"}," name: gaia\n server_name: gaiad\n version: 4.0.2\n commit: 6d46572f3273423ad9562cf249a86ecc8206e207\n build_tags: netgo,ledger\n ...\n")),(0,o.kt)("p",{parentName:"li"}," The version/commit hash of Gaia v4.0.2: ",(0,o.kt)("inlineCode",{parentName:"p"},"6d46572f3273423ad9562cf249a86ecc8206e207"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Migrate exported state from the current v2.0.15 version to the new v4.0.2 version:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gaiad migrate cosmoshub_3_genesis_export.json --chain-id=cosmoshub-4 --initial-height [last_cosmoshub-3_block+1] > genesis.json\n")),(0,o.kt)("p",{parentName:"li"},"This will migrate our exported state into the required ",(0,o.kt)("inlineCode",{parentName:"p"},"genesis.json")," file to start the cosmoshub-4.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Verify the SHA256 of the final genesis JSON:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ jq -S -c -M '' genesis.json | shasum -a 256\n[SHA256_VALUE]  genesis.json\n")),(0,o.kt)("p",{parentName:"li"}," Compare this value with other validators / full node operators of the network.\nIt is important that each party can reproduce the same genesis.json file from the steps accordingly.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Reset state:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"NOTE"),": Be sure you have a complete backed up state of your node before proceeding with this step.\nSee ",(0,o.kt)("a",{parentName:"p",href:"#recovery"},"Recovery")," for details on how to proceed."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gaiad unsafe-reset-all\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Move the new ",(0,o.kt)("inlineCode",{parentName:"p"},"genesis.json")," to your ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia/config/")," directory"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cp genesis.json ~/.gaia/config/\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start your blockchain"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gaiad start\n")),(0,o.kt)("p",{parentName:"li"},"Automated audits of the genesis state can take 30-120 min using the crisis module. This can be disabled by\n",(0,o.kt)("inlineCode",{parentName:"p"},"gaiad start --x-crisis-skip-assert-invariants"),"."))),(0,o.kt)("h1",{id:"guidance-for-full-node-operators"},"Guidance for Full Node Operators"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Verify you are currently running the correct version (v2.0.15) of ",(0,o.kt)("em",{parentName:"p"},"gaiad"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"}," $ gaiad version --long\n name: gaia\n server_name: gaiad\n client_name: gaiacli\n version: 2.0.15\n commit: 89cf7e6fc166eaabf47ad2755c443d455feda02e\n build_tags: netgo,ledger\n go: go version go1.15 darwin/amd64\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Stop your Gaia v2.0.15 instance.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"After the chain has halted, make a backup of your ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia")," directory"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mv ~/.gaia ./gaiad_backup\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"NOTE"),": It is recommended for validators and operators to take a full data snapshot at the export\nheight before proceeding in case the upgrade does not go as planned or if not enough voting power\ncomes online in a sufficient and agreed upon amount of time. That means the backup of ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia")," should\nonly take place once the chain has halted at UNIX time ",(0,o.kt)("inlineCode",{parentName:"p"},"1613628000"),".\nIn such a case, the chain will fallback\nto continue operating ",(0,o.kt)("inlineCode",{parentName:"p"},"cosmoshub-3"),". See ",(0,o.kt)("a",{parentName:"p",href:"#recovery"},"Recovery")," for details on how to proceed.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Download the cosmoshub-4 genesis file from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/mainnet"},"Cosmos Mainnet Github"),".\nThis file will be generated by a validator that is migrating from cosmoshub-3 to cosmoshub-4.\nThe cosmoshub-4 genesis file will be validated by community participants, and\nthe hash of the file will be shared on the #validators-verified channel of the ",(0,o.kt)("a",{parentName:"p",href:"https://discord.gg/cosmosnetwork"},"Cosmos Discord"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Install v4.0.2 of ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cosmos/gaia"},"Gaia"),"."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"NOTE"),": Go ",(0,o.kt)("a",{parentName:"p",href:"https://golang.org/dl/"},"1.15+")," is required!"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/cosmos/gaia.git && cd gaia && git checkout v4.0.2; make install\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Verify you are currently running the correct version (v4.0.2) of the ",(0,o.kt)("em",{parentName:"p"},"Gaia"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"}," name: gaia\n server_name: gaiad\n version: 4.0.2\n commit: 6d46572f3273423ad9562cf249a86ecc8206e207\n build_tags: netgo,ledger\n ...\n")),(0,o.kt)("p",{parentName:"li"},"The version/commit hash of Gaia v4.0.2: ",(0,o.kt)("inlineCode",{parentName:"p"},"6d46572f3273423ad9562cf249a86ecc8206e207"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Reset state:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"NOTE"),": Be sure you have a complete backed up state of your node before proceeding with this step.\nSee ",(0,o.kt)("a",{parentName:"p",href:"#recovery"},"Recovery")," for details on how to proceed."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gaiad unsafe-reset-all\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Move the new ",(0,o.kt)("inlineCode",{parentName:"p"},"genesis.json")," to your ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia/config/")," directory"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cp genesis.json ~/.gaia/config/\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start your blockchain"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gaiad start\n")),(0,o.kt)("p",{parentName:"li"},"Automated audits of the genesis state can take 30-120 min using the crisis module. This can be disabled by\n",(0,o.kt)("inlineCode",{parentName:"p"},"gaiad start --x-crisis-skip-assert-invariants"),"."))),(0,o.kt)("h2",{id:"notes-for-service-providers"},"Notes for Service Providers"),(0,o.kt)("h1",{id:"rest-server"},"REST server"),(0,o.kt)("p",null,"In case you have been running REST server with the command ",(0,o.kt)("inlineCode",{parentName:"p"},"gaiacli rest-server")," previously, running this command will not be necessary anymore.\nAPI server is now in-process with daemon and can be enabled/disabled by API configuration in your ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia/config/app.toml"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[api]\n# Enable defines if the API server should be enabled.\nenable = false\n# Swagger defines if swagger documentation should automatically be registered.\nswagger = false\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"swagger")," setting refers to enabling/disabling swagger docs API, i.e, /swagger/ API endpoint."),(0,o.kt)("h1",{id:"grpc-configuration"},"gRPC Configuration"),(0,o.kt)("p",null,"gRPC configuration in your ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia/config/app.toml")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'[grpc]\n# Enable defines if the gRPC server should be enabled.\nenable = true\n# Address defines the gRPC server address to bind to.\naddress = "0.0.0.0:9090"\n')),(0,o.kt)("h1",{id:"state-sync"},"State Sync"),(0,o.kt)("p",null,"State Sync Configuration in your ",(0,o.kt)("inlineCode",{parentName:"p"},".gaia/config/app.toml")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# State sync snapshots allow other nodes to rapidly join the network without replaying historical\n# blocks, instead downloading and applying a snapshot of the application state at a given height.\n[state-sync]\n# snapshot-interval specifies the block interval at which local state sync snapshots are\n# taken (0 to disable). Must be a multiple of pruning-keep-every.\nsnapshot-interval = 0\n# snapshot-keep-recent specifies the number of recent snapshots to keep and serve (0 to keep all).\nsnapshot-keep-recent = 2\n")))}d.isMDXComponent=!0}}]);